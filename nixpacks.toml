# Force Nixpacks to use Python ONLY - Override auto-detection
# Explicitly specify Python as the only provider to prevent Node.js detection
providers = ["python"]

[phases.setup]
nixPkgs = ["python311", "python311Packages.pip", "python311Packages.virtualenv"]

[phases.install]
cmds = [
  "python -m venv /app/venv",
  "/app/venv/bin/pip install --no-cache-dir --upgrade pip",
  "/app/venv/bin/pip install --no-cache-dir 'numpy<2.0' 'typing-extensions' 'sympy' 'networkx' 'jinja2' 'fsspec' 'filelock' 'certifi' 'charset-normalizer' 'idna' 'urllib3' 'requests' 'pillow>=10.0.0' 'gunicorn==21.2.0'",
  "/app/venv/bin/pip install --no-cache-dir --index-url https://download.pytorch.org/whl/cpu torch==2.1.0+cpu torchvision==0.16.0+cpu --no-deps",
  "/app/venv/bin/pip install --no-cache-dir -r backend/models/requirements.txt"
]

[phases.build]
cmds = [
  "cd backend/models && /app/venv/bin/python validate_startup.py || echo 'Validation warnings (non-critical)'"
]

[start]
cmd = "cd backend/models && /app/venv/bin/python validate_startup.py && /app/venv/bin/gunicorn --config gunicorn_config.py pytorch_service:app"



